<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Apply Cross-Validation to Nested Data — nest_cv • mintyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Apply Cross-Validation to Nested Data — nest_cv"><meta property="og:description" content="The nest_cv function applies cross-validation splits to nested data frames or data tables within a data table. It uses the rsample package's vfold_cv function to create cross-validation splits for predictive modeling and analysis on nested datasets."><meta property="og:image" content="https://tony2015116.github.io/mintyr/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mintyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="divider">
    <li class="dropdown-header">tutorial</li>
    <li>
      <a href="../articles/get-started.html">Get started</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tony2015116/mintyr" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://github.com/tony2015116/mintyr/discussions" class="external-link">
    <span class="fa fa-users fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply Cross-Validation to Nested Data</h1>
    <small class="dont-index">Source: <a href="https://github.com/tony2015116/mintyr/blob/v0.1.0/R/nest_cv.R" class="external-link"><code>R/nest_cv.R</code></a></small>
    <div class="hidden name"><code>nest_cv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>nest_cv</code> function applies cross-validation splits to nested data frames or data tables within a data table. It uses the <code>rsample</code> package's <code>vfold_cv</code> function to create cross-validation splits for predictive modeling and analysis on nested datasets.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nest_cv</span><span class="op">(</span></span>
<span>  <span class="va">nest_dt</span>,</span>
<span>  v <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  repeats <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  pool <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-nest-dt">nest_dt<a class="anchor" aria-label="anchor" href="#arg-nest-dt"></a></dt>
<dd><p>A <code>data.frame</code> or <code>data.table</code> containing at least one nested
<code>data.frame</code> or <code>data.table</code> column.</p><ul><li><p>Supports multi-level nested structures</p></li>
<li><p>Requires at least one nested data column</p></li>
</ul></dd>


<dt id="arg-v">v<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>The number of partitions of the data set.</p></dd>


<dt id="arg-repeats">repeats<a class="anchor" aria-label="anchor" href="#arg-repeats"></a></dt>
<dd><p>The number of times to repeat the V-fold partitioning.</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>A variable in <code>data</code> (single character or name) used to conduct
stratified sampling. When not <code>NULL</code>, each resample is created within the
stratification variable. Numeric <code>strata</code> are binned into quartiles.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>A single number giving the number of bins desired to stratify a
numeric stratification variable.</p></dd>


<dt id="arg-pool">pool<a class="anchor" aria-label="anchor" href="#arg-pool"></a></dt>
<dd><p>A proportion of data used to determine if a particular group is
too small and should be pooled into another group. We do not recommend
decreasing this argument below its default of 0.1 because of the dangers
of stratifying groups that are too small.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>These dots are for future extensions and must be empty.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>data.table</code> containing the cross-validation splits for each nested dataset. It includes:</p><ul><li><p>Original non-nested columns from <code>nest_dt</code>.</p></li>
<li><p><code>splits</code>: The cross-validation split objects returned by <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv</a></code>.</p></li>
<li><p><code>train</code>: The training data for each split.</p></li>
<li><p><code>validate</code>: The validation data for each split.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function performs the following steps:</p><ol><li><p>Checks if the input <code>nest_dt</code> is non-empty and contains at least one nested column of <code>data.frame</code>s or <code>data.table</code>s.</p></li>
<li><p>Identifies the nested columns and non-nested columns within <code>nest_dt</code>.</p></li>
<li><p>Applies <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv</a></code> to each nested data frame in the specified nested column(s), creating the cross-validation splits.</p></li>
<li><p>Expands the cross-validation splits and associates them with the non-nested columns.</p></li>
<li><p>Extracts the training and validation data for each split and adds them to the output data table.</p></li>
</ol><p>If the <code>strata</code> parameter is provided, stratified sampling is performed during the cross-validation. Additional arguments can be passed to <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv</a></code> via <code>...</code>.</p>
    </div>
    <div id="note">
    <h2>Note</h2>

<ul><li><p>The <code>nest_dt</code> must contain at least one nested column of <code>data.frame</code>s or <code>data.table</code>s.</p></li>
<li><p>The function converts <code>nest_dt</code> to a <code>data.table</code> internally to ensure efficient data manipulation.</p></li>
<li><p>The <code>strata</code> parameter should be a column name present in the nested data frames.</p></li>
<li><p>If <code>strata</code> is specified, ensure that the specified column exists in all nested data frames.</p></li>
<li><p>The <code>breaks</code> and <code>pool</code> parameters are used when <code>strata</code> is a numeric variable and control how stratification is handled.</p></li>
<li><p>Additional arguments passed through <code>...</code> are forwarded to <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv</a></code>.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p><code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv()</a></code> Underlying cross-validation function</p></li>
<li><p><code><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">rsample::training()</a></code> Extract training set</p></li>
<li><p><code><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">rsample::testing()</a></code> Extract test set</p></li>
</ul></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example: Cross-validation for nested data.table demonstrations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setup test data</span></span></span>
<span class="r-in"><span><span class="va">dt_nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="w2l_nest.html">w2l_nest</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">iris</span>,                   <span class="co"># Input dataset</span></span></span>
<span class="r-in"><span>  cols2l <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>                   <span class="co"># Nest first 2 columns</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Basic 2-fold cross-validation</span></span></span>
<span class="r-in"><span><span class="fu">nest_cv</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nest_dt <span class="op">=</span> <span class="va">dt_nest</span>,             <span class="co"># Input nested data.table</span></span></span>
<span class="r-in"><span>  v <span class="op">=</span> <span class="fl">2</span>                          <span class="co"># Number of folds (2-fold CV)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            name                     splits     id              train</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;fctr&gt;                     &lt;list&gt; &lt;char&gt;             &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: Sepal.Length &lt;vfold_split[75x75x150x4]&gt;  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: Sepal.Length &lt;vfold_split[75x75x150x4]&gt;  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt;  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt;  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              validate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: &lt;data.table[75x4]&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Repeated 2-fold cross-validation</span></span></span>
<span class="r-in"><span><span class="fu">nest_cv</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nest_dt <span class="op">=</span> <span class="va">dt_nest</span>,             <span class="co"># Input nested data.table</span></span></span>
<span class="r-in"><span>  v <span class="op">=</span> <span class="fl">2</span>,                         <span class="co"># Number of folds (2-fold CV)</span></span></span>
<span class="r-in"><span>  repeats <span class="op">=</span> <span class="fl">2</span>                    <span class="co"># Number of repetitions</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            name                     splits      id    id2              train</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;fctr&gt;                     &lt;list&gt;  &lt;char&gt; &lt;char&gt;             &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: Sepal.Length &lt;vfold_split[75x75x150x4]&gt; Repeat1  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: Sepal.Length &lt;vfold_split[75x75x150x4]&gt; Repeat1  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: Sepal.Length &lt;vfold_split[75x75x150x4]&gt; Repeat2  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: Sepal.Length &lt;vfold_split[75x75x150x4]&gt; Repeat2  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt; Repeat1  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt; Repeat1  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt; Repeat2  Fold1 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8:  Sepal.Width &lt;vfold_split[75x75x150x4]&gt; Repeat2  Fold2 &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              validate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7: &lt;data.table[75x4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8: &lt;data.table[75x4]&gt;</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Guo Meng.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

